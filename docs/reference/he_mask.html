<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mask Visium H&amp;E image — he_mask • Kandinsky</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Mask Visium H&amp;E image — he_mask"><meta property="og:description" content="create a mask image to remove image background from Visium H&amp;amp;E images"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Kandinsky</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/modC.html">Kandinsky cell/spot-neighbour based comparison</a>
    </li>
    <li>
      <a href="../articles/modD.html">Kandinsky cell/spot co-localization</a>
    </li>
    <li>
      <a href="../articles/modE.html">Kandinsky hot/cold areas</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ciccalab/Kandinsky/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Mask Visium H&amp;E image</h1>
    <small class="dont-index">Source: <a href="https://github.com/ciccalab/Kandinsky/blob/HEAD/R/00_Kandinsky_Class_funcs.R" class="external-link"><code>R/00_Kandinsky_Class_funcs.R</code></a></small>
    <div class="hidden name"><code>he_mask.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>create a mask image to remove image background from Visium H&amp;E images</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">he_mask</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  maxres <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  stretch <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  sd_thresh <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  crop <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  crop_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Seurat'</span></span>
<span><span class="fu">he_mask</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  maxres <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  stretch <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  sd_thresh <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  crop <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  crop_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'SpatRaster'</span></span>
<span><span class="fu">he_mask</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  maxres <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  stretch <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  sd_thresh <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  crop <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  crop_area <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a Seurat object containing Kandinsky data (`KanData()`) or an image of class `SpatRaster` created with the `terra` package</p></dd>


<dt id="arg-maxres">maxres<a class="anchor" aria-label="anchor" href="#arg-maxres"></a></dt>
<dd><p>numeric value indicating the ideal maximum pixel dimension accepted for Visium H&amp;E image. If image size is bigger than this value, a scale factor will be applied to lower image pixel resolution/size up to the defined maximum value</p></dd>


<dt id="arg-stretch">stretch<a class="anchor" aria-label="anchor" href="#arg-stretch"></a></dt>
<dd><p>boolean value, whether or not to apply a linear stretch to increase masked image contrast. Default is FALSE</p></dd>


<dt id="arg-sd-thresh">sd_thresh<a class="anchor" aria-label="anchor" href="#arg-sd-thresh"></a></dt>
<dd><p>numeric value indicating the minimum RGB standard deviation accepted to keep an image pixel as part of the final tissue mask. Lower `sd_thresh` values will give more permissive filtering results.</p></dd>


<dt id="arg-crop">crop<a class="anchor" aria-label="anchor" href="#arg-crop"></a></dt>
<dd><p>boolean value, whether or not to crop the final masked image</p></dd>


<dt id="arg-crop-area">crop_area<a class="anchor" aria-label="anchor" href="#arg-crop-area"></a></dt>
<dd><p>bounding box coordinates to be used to crop masked image. If `crop = T` and `crop_area` is set to `NULL`, Visium spot coordinates will be used to automatically define the bounding box for cropping the image</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Seurat object with new 'masked_img' slot within the Kandinsky data if object is a Seurat object, or a masked `Spatraster` image</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Additional details...
This function will apply a variance-based threshold to the RGB channels of the H&amp;E image stored within the Kandinsky data
to keep only the area of image covering the tissue sample and to remove the rest of the image background. The masking strategy relies on the fact
that RGB values from H&amp;E staining will usually show a higher standard deviation compared to the gray-ish Visium slide background.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Pietro Andrei, Mariachiara Grieco, Matteo Cereda, Francesca Ciccarelli.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

